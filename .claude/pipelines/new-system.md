# 새 시스템 생성 파이프라인 (병렬 구현 버전)

새로운 Unity 시스템을 생성할 때 이 파이프라인을 따릅니다.

## 트리거

다음 패턴의 요청 시 자동 실행:
- "XX 시스템 만들어줘"
- "XX System 구현해줘"
- "새로운 XX 기능 추가"
- `/feature XX` 명령어

## 입력 파라미터

- `{{system_name}}`: 시스템 이름 (예: Inventory, Combat, Quest)
- `{{requirements}}`: 기능 요구사항 (선택)

---

## 전체 흐름

```
┌─────────────────────────────────────────────────────────────┐
│  1단계: 구조 생성 (스크립트)                                  │
│  → 폴더 + 빈 파일 생성                                       │
└─────────────────────┬───────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────────────────┐
│  2단계: 설계 (lead-architect - DESIGN 모드)                  │
│  → 인터페이스 설계 + 작업 분배                               │
└─────────────────────┬───────────────────────────────────────┘
                      ↓
        ┌─────────────┼─────────────┐
        ↓             ↓             ↓
┌────────────┐ ┌────────────┐ ┌────────────┐
│ 3-1단계    │ │ 3-2단계    │ │ 3-3단계    │
│ impl-1    │ │ impl-2    │ │ impl-3    │
│ 클래스A   │ │ 클래스B   │ │ 클래스C   │
│ +테스트   │ │ +테스트   │ │ +테스트   │
└─────┬─────┘ └─────┬─────┘ └─────┬─────┘
      │             │             │
      └─────────────┼─────────────┘
                    ↓ (병렬 완료 후)
┌─────────────────────────────────────────────────────────────┐
│  4단계: 검토 (lead-architect - REVIEW 모드)                  │
│  → 코드 검토, 문제 발견 시 재작업 요청                       │
└─────────────────────┬───────────────────────────────────────┘
                      ↓
              ┌───────┴───────┐
              ↓               ↓
        [문제 없음]      [문제 발견]
              ↓               ↓
              ↓         해당 impl에게
              ↓         재작업 요청
              ↓               ↓
              └───────┬───────┘
                      ↓
┌─────────────────────────────────────────────────────────────┐
│  5단계: 통합 (lead-architect - INTEGRATE 모드)               │
│  → 최종 통합, 문서화                                         │
└─────────────────────────────────────────────────────────────┘
```

---

## 파이프라인 단계

### 1단계: 구조 생성 (스크립트) ⚡

**목적**: 폴더와 빈 파일 생성 (컨텍스트 절약)

```bash
.claude/scripts/create-structure.sh {{system_name}}
```

**결과물**:
```
Assets/01_Scripts/03_Systems/XX_{{system_name}}/
├── 01_Interfaces/I{{system_name}}.cs
├── 02_Core/
│   ├── {{system_name}}Controller.cs
│   ├── {{system_name}}Validator.cs (필요시)
│   └── {{system_name}}Repository.cs (필요시)
└── 03_Mono/

Assets/01_Scripts/05_Tests/{{system_name}}/
├── {{system_name}}ControllerTests.cs
├── {{system_name}}ValidatorTests.cs (필요시)
└── {{system_name}}RepositoryTests.cs (필요시)
```

**컨텍스트 사용**: 최소 (스크립트 실행 결과만)

---

### 2단계: 설계 (lead-architect - DESIGN 모드) 🏗️

**목적**: 인터페이스 설계, OCP 확장 포인트 정의, **작업 분배**

**호출**:
```
lead-architect 에이전트에게:
- mode: DESIGN
- system_name: {{system_name}}
- requirements: {{requirements}}
- interface_file: (1단계에서 생성된 경로)
```

**결과물**:
- 완성된 `I{{system_name}}.cs`
- 확장 인터페이스 (필요시)
- **작업 분배 계획** (implementer별 담당 클래스)

**컨텍스트 사용**: 독립 (서브에이전트)

---

### 3단계: 병렬 구현 (implementer-1, 2, 3) 🔨🔨🔨

**목적**: Pure C# 로직 + 테스트 코드 **병렬 작성**

**병렬 호출**:
```
# 동시에 3개 에이전트 실행
implementer-1 에이전트에게:
- class_name: {{lead가 분배한 클래스 A}}
- responsibility: {{클래스 A의 책임}}
- ...

implementer-2 에이전트에게:
- class_name: {{lead가 분배한 클래스 B}}
- responsibility: {{클래스 B의 책임}}
- ...

implementer-3 에이전트에게:
- class_name: {{lead가 분배한 클래스 C}}
- responsibility: {{클래스 C의 책임}}
- ...
```

**결과물** (각각):
- 담당 클래스 구현 파일
- 담당 클래스 테스트 파일

**컨텍스트 사용**: 독립 × 3 (병렬 서브에이전트)

---

### 4단계: 검토 (lead-architect - REVIEW 모드) ✅

**목적**: SOLID 검토, 안전성 평가, **재작업 지시**

**호출**:
```
lead-architect 에이전트에게:
- mode: REVIEW
- files: 3단계 모든 결과물
- project_stage: PROJECT_CONTEXT.md에서 읽음
```

**결과물**:
- 리뷰 리포트
- 수정 필요 시 해당 implementer에게 재작업 요청

**재작업 루프**:
```
문제 발견 시:
→ 해당 implementer 재호출 (수정 사항 전달)
→ 다시 4단계 검토
→ 통과할 때까지 반복 (최대 2회)
```

**컨텍스트 사용**: 독립 (서브에이전트)

---

### 5단계: 통합 (lead-architect - INTEGRATE 모드) 📦

**목적**: 최종 통합, 컴파일 확인, 문서화

**호출**:
```
lead-architect 에이전트에게:
- mode: INTEGRATE
- files: 모든 결과물
```

**결과물**:
- 통합 완료 보고서
- 최종 파일 구조 문서

**컨텍스트 사용**: 독립 (서브에이전트)

---

## 프로젝트 단계별 분기

### Prototype
```
1단계 → 2단계(간소화) → 3단계(impl-1만) → 5단계
설계 최소화, 단일 구현자, 빠른 완료
```

### Alpha
```
1단계 → 2단계 → 3단계(병렬) → 4단계 → 5단계
전체 파이프라인, SOLID 적용, 철저한 검토
```

### Beta / Live
```
⚠️ 경고 출력 후 사용자 확인
새 시스템 생성보다 기존 확장 포인트 활용 권장
```

---

## 병렬 처리 효과

| 구분 | 순차 실행 | 병렬 실행 |
|-----|----------|----------|
| 3단계 소요 | impl-1 → impl-2 → impl-3 | impl-1, 2, 3 동시 |
| 예상 시간 | 3x | 1x |
| 컨텍스트 | 누적 | 독립 |

---

## 예상 효과

| 구분 | 기존 방식 | 새 파이프라인 |
|-----|----------|--------------|
| 컨텍스트 | 100% | ~15% |
| 구현 속도 | 순차 | **병렬 3배** |
| 일관성 | 낮음 | 높음 |
| 코드 품질 | 가변적 | 검토 필수 |
| 재작업 루프 | 없음 | **자동 피드백** |

---

## 사용 예시

```
사용자: "/feature Inventory"

→ 메인 에이전트가 이 파이프라인 실행
→ 1단계: create-structure.sh Inventory
→ 2단계: lead-architect (DESIGN) → 인터페이스 + 작업 분배
→ 3단계: implementer-1, 2, 3 **병렬 실행**
→ 4단계: lead-architect (REVIEW) → 검토, 필요시 재작업
→ 5단계: lead-architect (INTEGRATE) → 통합 완료
→ 결과 요약 보고
```

```
사용자: "인벤토리 시스템 만들어줘. 아이템 추가/제거/조회 기능 필요해."

→ 위와 동일 (requirements에 기능 요구사항 포함)
```
